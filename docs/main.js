(()=>{"use strict";const t={get t(){return{x:0,y:0,z:0}},get i(){return{x:1,y:1,z:1}},get random(){return{x:Math.random(),y:Math.random(),z:Math.random()}}};function i(t,i=1,s){return new Array(4*t).fill(1).map(((t,e)=>(e+1)%4==0?i:s??Math.random()))}function s(t=0,i=0,s=0){return{x:t,y:i,z:s}}function e(t){return t*(Math.PI/180)}function n(t,i){let s=[];const e=t[0],n=t[1],r=t[2],h=t[3],o=t[4],a=t[5],c=t[6],u=t[7],d=t[8],L=t[9],l=t[10],G=t[11],f=t[12],p=t[13],y=t[14],m=t[15];let x=i[0],M=i[1],w=i[2],v=i[3];return s[0]=x*e+M*o+w*d+v*f,s[1]=x*n+M*a+w*L+v*p,s[2]=x*r+M*c+w*l+v*y,s[3]=x*h+M*u+w*G+v*m,x=i[4],M=i[5],w=i[6],v=i[7],s[4]=x*e+M*o+w*d+v*f,s[5]=x*n+M*a+w*L+v*p,s[6]=x*r+M*c+w*l+v*y,s[7]=x*h+M*u+w*G+v*m,x=i[8],M=i[9],w=i[10],v=i[11],s[8]=x*e+M*o+w*d+v*f,s[9]=x*n+M*a+w*L+v*p,s[10]=x*r+M*c+w*l+v*y,s[11]=x*h+M*u+w*G+v*m,x=i[12],M=i[13],w=i[14],v=i[15],s[12]=x*e+M*o+w*d+v*f,s[13]=x*n+M*a+w*L+v*p,s[14]=x*r+M*c+w*l+v*y,s[15]=x*h+M*u+w*G+v*m,s}const r={h:function(t,i,s,e){const n=1/Math.tan(t/2),r=1/(s-e);return[n/i,0,0,0,0,n,0,0,0,0,(s+e)*r,-1,0,0,s*e*r*2,0]},o:function(t,i,s,e,n,r){const h=1/(t-i),o=1/(s-e),a=1/(n-r);return[-2*h,0,0,0,0,-2*o,0,0,0,0,2*a,0,(t+i)*h,(e+s)*o,(r+n)*a,1]},u:function(t){let i=t[0];for(let s=1;s<t.length;s++)i=n(i,t[s]);return i},L:function(t,i,s){return[t,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1]},l:function(t){const i=Math.cos(t),s=Math.sin(t);return[i,0,s,0,0,1,0,0,-s,0,i,0,0,0,0,1]},G:function(t){const i=Math.cos(t),s=Math.sin(t);return[1,0,0,0,0,i,-s,0,0,s,i,0,0,0,0,1]},p:function(t){const i=Math.cos(t),s=Math.sin(t);return[i,-s,0,0,s,i,0,0,0,0,1,0,0,0,0,1]},m:function(t,i,s){return[1,0,0,0,0,1,0,0,0,0,1,0,t,i,s,1]}},h={perspective:function(t,i,s,e){var n=Math.tan(.5*Math.PI-.5*t),r=1/(s-e);return[n/i,0,0,0,0,n,0,0,0,0,(s+e)*r,-1,0,0,s*e*r*2,0]},M:function(t,i,s){return[2/t,0,0,0,0,-2/i,0,0,0,0,2/s,0,-1,1,0,1]},multiply:function(t,i){var s=t[0],e=t[1],n=t[2],r=t[3],h=t[4],o=t[5],a=t[6],c=t[7],u=t[8],d=t[9],L=t[10],l=t[11],G=t[12],f=t[13],p=t[14],y=t[15],m=i[0],x=i[1],M=i[2],w=i[3],v=i[4],z=i[5],g=i[6],b=i[7],A=i[8],k=i[9],C=i[10],R=i[11],S=i[12],j=i[13],O=i[14],F=i[15];return[m*s+x*h+M*u+w*G,m*e+x*o+M*d+w*f,m*n+x*a+M*L+w*p,m*r+x*c+M*l+w*y,v*s+z*h+g*u+b*G,v*e+z*o+g*d+b*f,v*n+z*a+g*L+b*p,v*r+z*c+g*l+b*y,A*s+k*h+C*u+R*G,A*e+k*o+C*d+R*f,A*n+k*a+C*L+R*p,A*r+k*c+C*l+R*y,S*s+j*h+O*u+F*G,S*e+j*o+O*d+F*f,S*n+j*a+O*L+F*p,S*r+j*c+O*l+F*y]},v:function(t,i,s){return[1,0,0,0,0,1,0,0,0,0,1,0,t,i,s,1]},g:function(t){var i=Math.cos(t),s=Math.sin(t);return[1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1]},A:function(t){var i=Math.cos(t),s=Math.sin(t);return[i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1]},k:function(t){var i=Math.cos(t),s=Math.sin(t);return[i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1]},C:function(t,i,s){return[t,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1]},translate:function(t,i,s,e){return h.multiply(t,h.v(i,s,e))},R:function(t,i){return h.multiply(t,h.g(i))},S:function(t,i){return h.multiply(t,h.A(i))},j:function(t,i){return h.multiply(t,h.k(i))},scale:function(t,i,s,e){return h.multiply(t,h.C(i,s,e))},inverse:function(t){var i=t[0],s=t[1],e=t[2],n=t[3],r=t[4],h=t[5],o=t[6],a=t[7],c=t[8],u=t[9],d=t[10],L=t[11],l=t[12],G=t[13],f=t[14],p=t[15],y=d*p,m=f*L,x=o*p,M=f*a,w=o*L,v=d*a,z=e*p,g=f*n,b=e*L,A=d*n,k=e*a,C=o*n,R=c*G,S=l*u,j=r*G,O=l*h,F=r*u,P=c*h,U=i*G,B=l*s,E=i*u,V=c*s,$=i*h,q=r*s,I=y*h+M*u+w*G-(m*h+x*u+v*G),K=m*s+z*u+A*G-(y*s+g*u+b*G),N=x*s+g*h+k*G-(M*s+z*h+C*G),T=v*s+b*h+C*u-(w*s+A*h+k*u),D=1/(i*I+r*K+c*N+l*T);return[D*I,D*K,D*N,D*T,D*(m*r+x*c+v*l-(y*r+M*c+w*l)),D*(y*i+g*c+b*l-(m*i+z*c+A*l)),D*(M*i+z*r+C*l-(x*i+g*r+k*l)),D*(w*i+A*r+k*c-(v*i+b*r+C*c)),D*(R*a+O*L+F*p-(S*a+j*L+P*p)),D*(S*n+U*L+V*p-(R*n+B*L+E*p)),D*(j*n+B*a+$*p-(O*n+U*a+q*p)),D*(P*n+E*a+q*L-(F*n+V*a+$*L)),D*(j*d+P*f+S*o-(F*f+R*o+O*d)),D*(E*f+R*e+B*d-(U*d+V*f+S*e)),D*(U*o+q*f+O*e-($*f+j*e+B*o)),D*($*d+F*e+V*o-(E*o+q*d+P*e))]},O:function(t,i){for(var s=[],e=0;e<4;++e){s[e]=0;for(var n=0;n<4;++n)s[e]+=i[n]*t[4*n+e]}return s}},o=.5*Math.PI/2;class a{F;P;rotation;U;position;B;constructor(i,s){this.F=i,this.P=i.P,this.rotation=s?.rotation??t.t,this.position=s?.position??t.t,this.U=s?.U??o}update(){let t=h.g(e(this.rotation.x)),i=h.A(e(this.rotation.y)),s=h.k(e(this.rotation.z)),n=r.u([t,i,s]);const{x:o,y:a,z:c}=this.position;this.B=h.translate(n,o,a,c)}setPosition(t=0,i=0,s=0){this.position.x=t,this.position.y=i,this.position.z=s}V(t=0,i=0,s=0){this.rotation.x=t,this.rotation.y=i,this.rotation.z=s}$(t){if(this.U=t?.U??this.U,this.position){const{x:i,y:s,z:e}=t.position;this.setPosition(i,s,e)}if(t.rotation){const{x:i,y:s,z:e}=t.rotation;this.V(i,s,e)}}}class c{name;q;constructor(t,i,s){this.name=t;const e=this.I(GL.VERTEX_SHADER,i),n=this.I(GL.FRAGMENT_SHADER,s);this.createProgram(e,n)}I(t,i){const s=GL.createShader(t);GL.shaderSource(s,i),GL.compileShader(s);let e=GL.getShaderInfoLog(s);if(e)throw new Error(`Shader ${this.name} compile error: ${e}`);return s}createProgram(t,i){return this.q=GL.createProgram(),GL.attachShader(this.q,t),GL.attachShader(this.q,i),GL.linkProgram(this.q),this.q}}class u{canvas;K;N;T=new Map;M;F;constructor(t){this.F=t,this.init()}init(){this.canvas=document.querySelector("#c"),GL=this.K=this.canvas.getContext("webgl2"),GL.enable(GL.DEPTH_TEST),this.N=new a(this.F,{rotation:{x:5,y:0,z:0}}),this.resize(),addEventListener("resize",this.resize.bind(this)),this.D(),this.H()}H(){const t=this.N.U,i=this.K.canvas.width/this.K.canvas.height;this.M=r.h(t,i,.01,5e3),this.N.update()}W(t,i,s){const e=new c(t,i,s);return this.T.set(e.name,e),e}resize(){const{innerWidth:t,innerHeight:i}=window;GL.canvas.width=t,GL.canvas.height=i,GL.viewport(0,0,t,i),console.log("resize"),GL.enable(GL.BLEND),GL.blendFunc(GL.SRC_ALPHA,GL.ONE_MINUS_SRC_ALPHA),function(t,i){i=i||1;const s=t.clientWidth*i|0,e=t.clientHeight*i|0;(t.width!==s||t.height!==e)&&(t.width=s,t.height=e)}(this.canvas,1),this.H()}D(){GL.clearColor(.796,.953,.941,1),GL.clear(GL.COLOR_BUFFER_BIT)}X(t){this.D(),t.forEach((t=>{t.X()}))}Y(t){return this.T.get(t)}}class d{Z;name;F;_;position;origin;scale;rotation;constructor(i,s){this.name=s.name,this.F=i,this.position=s.position??t.t,this.scale=s.scale??t.i,this.origin=s.origin??t.t,this.rotation=s.rotation??t.t,s.Z&&this.J(s.Z),s._&&(this._=s._.bind(this)),this.init()}init(){}J(t){this.Z=t,this.Z.tt(this)}update(t){this.it(),this.Z?.update(t),this._&&this._(t)}X(){this.Z&&this.Z.X(this.position)}st(){}moveBy(t=0,i=0,s=0){this.position.x+=t,this.position.y+=i,this.position.z+=s}et(t,i=t,s=t){const e=this.scale;e.x=e.x+t,e.y=e.y+i,e.z=e.z+s}nt(t,i,s){const e=this.rotation;e.x=e.x+t,e.y=e.y+i,e.z=e.z+s}it(){}}class L{rt=new Map;actions=new Map;constructor(){addEventListener("keydown",(t=>{this.ht(t.key,!0)})),addEventListener("keyup",(t=>{this.ht(t.key,!1)}))}ht(t,i){this.rt.set(t,i)}ot(t,i){this.actions.set(t,i)}update(){[...this.actions].filter((t=>this.rt.get(t[0]))).forEach((t=>{t[1]()}))}}class l{ct;ut;dt;Lt=new Map;lt;Gt;ft;yt;F;position=t.t;xt;Mt;wt;constructor(t){this.ct=new Float32Array(t.ct??[]),this.ut=new Uint8Array(t.ut??[]),this.dt=new Float32Array(t.dt??[]),this.F=t.F,this.yt=this.F.P.Y(t.vt),this.init()}init(){this.Gt=GL.createBuffer(),this.lt=GL.createBuffer(),this.ft=GL.createBuffer(),GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.lt),GL.bufferData(GL.ELEMENT_ARRAY_BUFFER,this.ut,GL.STATIC_DRAW),GL.bindBuffer(GL.ARRAY_BUFFER,this.Gt),GL.bufferData(GL.ARRAY_BUFFER,this.ct,GL.STATIC_DRAW),GL.bindBuffer(GL.ARRAY_BUFFER,this.ft),GL.bufferData(GL.ARRAY_BUFFER,this.dt,GL.STATIC_DRAW)}bind(){GL.useProgram(this.yt.q),GL.bindBuffer(GL.ELEMENT_ARRAY_BUFFER,this.lt),GL.bindBuffer(GL.ARRAY_BUFFER,this.Gt),GL.vertexAttribPointer(0,3,GL.FLOAT,!1,0,0),GL.enableVertexAttribArray(0);const t=GL.getUniformLocation(this.yt.q,"uModel");GL.uniformMatrix4fv(t,!1,new Float32Array(this.Mt));const i=GL.getUniformLocation(this.yt.q,"uProjection");GL.uniformMatrix4fv(i,!1,new Float32Array(this.F.P.M)),GL.bindBuffer(GL.ARRAY_BUFFER,this.ft),GL.vertexAttribPointer(1,4,GL.FLOAT,!1,0,0),GL.enableVertexAttribArray(1)}update(t){this.F.P.H();const{x:i,y:s,z:e}=this.wt.scale,n=h.C(i,s,e),{x:o,y:a,z:c}=this.wt.rotation,u=r.G(o),d=r.l(a),L=r.p(c),{x:l,y:G,z:f}=this.wt.position,p=r.m(l,G,f),{x:y,y:m,z:x}=this.wt.origin,M=r.m(y,m,x),w=r.m(0,0,0);this.Mt=r.u([this.F.P.M,this.F.P.N.B,p,w,L,d,u,n,M])}X(t){this.position=t,this.bind(),GL.drawElements(GL.TRIANGLES,this.ut.length,GL.UNSIGNED_BYTE,0)}tt(t){this.wt=t}}class G extends l{constructor(t,s,e){super({F:t,vt:s,ct:[0,0,0,0,1,0,1,1,0,1,0,0],ut:[0,1,3,3,2,1],dt:e??i(4)})}}class f extends l{constructor(t,s,e){super({F:t,vt:s,ct:[0,0,-1,.85,-0,.5,-.85,-0,.5,0,2,0],ut:[0,3,1,0,1,2,1,3,2,2,3,0],dt:e??i(4)})}}class p extends d{init(){this.zt(),this.scale={x:.3,y:.3,z:.3}}zt(){const t=.1;this.F.gt([{key:"ArrowRight",action:()=>{this.moveBy(t)}},{key:"ArrowLeft",action:()=>{this.moveBy(-.1)}},{key:"ArrowUp",action:()=>{this.moveBy(0,0,-.1)}},{key:"ArrowDown",action:()=>{this.moveBy(0,0,t)}},{key:"a",action:()=>{this.moveBy(0,t,0)}},{key:"z",action:()=>{this.moveBy(0,-.1,0)}},{key:"q",action:()=>{this.nt(0,.05,0)}},{key:"w",action:()=>{this.moveBy(0,0,t)}}])}it(){this.F.P.N.setPosition(-this.position.x,-this.position.y-1,-this.position.z-4)}}window.GL=void 0;new class extends class{P;bt=[];input;paused;At=0;constructor(){this.init()}init(){this.P=new u(this),this.input=new L,this.kt(),this.Ct()}kt(){}Ct(){this.update(0)}pause(){this.paused=!0}resume(){this.paused=!1,this.update(this.At)}W(t,i,s){this.P.W(t,i,s)}it(){}update(t){this.it(),t-this.At!=0&&(t-=this.At),this.input.update(),this.bt.forEach((i=>i?.update(t))),this.P.X(this.bt),this.paused?this.At=t:requestAnimationFrame(this.update.bind(this))}Rt(t,i={}){const s=new d(this,{name:t,...i});return this.bt.push(s),s}St(t){this.bt.push(t)}jt(t){this.bt=this.bt.filter((i=>i.name!==t.name)),t.st()}gt(t){t.forEach((t=>this.input.ot(t.key,t.action)))}Ot(t){this.P.N.$(t)}}{Ft;kt(){this.W("basicShader","#version 300 es\nprecision mediump float;\n\nin vec3 aPosition;\nin vec4 aVertexColor;\nuniform mat4 uModel;\nout vec4 vColor;\n\nvoid main() {\n  gl_Position =  uModel * vec4(aPosition,1);\n  vColor = aVertexColor;\n}\n","#version 300 es\nprecision mediump float;\nin vec4 vColor;\n\nout vec4 fragColor;\nvoid main() {\n  fragColor = vColor;\n}"),this.Ot({position:{x:0,y:-5,z:0}}),this.Ft=new p(this,{name:"player",position:{x:0,y:-1,z:-7},Z:new f(this,"basicShader")}),this.St(this.Ft);this.Rt("ground",{position:{x:-50,y:-1,z:-20},Z:new G(this,"basicShader",i(4,.2,.4)),rotation:s(e(90)),scale:{x:1e3,y:100,z:1}});let t=[];for(let i=0;i<100;i++){let s=this.Rt(`o${i}`,{Z:new f(this,"basicShader"),position:{x:-2,y:-1,z:2*-i},_:function(t){this.position={x:Math.sin(t/500+i/5),y:this.position.y,z:this.position.z},this.rotation={x:0,y:Math.sin(t/500+i/5),z:0}}});s.scale={x:.4,y:.4,z:.4},t.push(s)}}}})();
//# sourceMappingURL=main.js.map